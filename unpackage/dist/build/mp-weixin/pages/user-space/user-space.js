(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user-space/user-space"],{"3d36":function(t,n,e){"use strict";(function(t){e("9e51");o(e("66fd"));var n=o(e("79b7"));function o(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,e("543d")["createPage"])},6754:function(t,n,e){"use strict";e.r(n);var o=e("e8b6"),r=e.n(o);for(var u in o)"default"!==u&&function(t){e.d(n,t,(function(){return o[t]}))}(u);n["default"]=r.a},"79b7":function(t,n,e){"use strict";e.r(n);var o=e("db00"),r=e("6754");for(var u in r)"default"!==u&&function(t){e.d(n,t,(function(){return r[t]}))}(u);var i,s=e("f0c5"),a=Object(s["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],i);n["default"]=a.exports},db00:function(t,n,e){"use strict";var o;e.d(n,"b",(function(){return r})),e.d(n,"c",(function(){return u})),e.d(n,"a",(function(){return o}));var r=function(){var t=this,n=t.$createElement,e=(t._self._c,t.__map(t.counts,(function(n,e){var o=t.__get_orig(n),r=t._f("formatNum")(n.num);return{$orig:o,f0:r}})));t.$mp.data=Object.assign({},{$root:{l0:e}})},u=[]},e8b6:function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=u(e("9918")),r=e("2f62");function u(t){return t&&t.__esModule?t:{default:t}}function i(t){return f(t)||c(t)||a(t)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(t,n){if(t){if("string"===typeof t)return l(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?l(t,n):void 0}}function c(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function f(t){if(Array.isArray(t))return l(t)}function l(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,o=new Array(n);e<n;e++)o[e]=t[e];return o}function p(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,o)}return e}function d(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?p(Object(e),!0).forEach((function(n){h(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):p(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function h(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}var m=["保密","未婚","已婚"],b=function(){Promise.all([e.e("common/vendor"),e.e("components/common/common-list2")]).then(function(){return resolve(e("9b75"))}.bind(null,e)).catch(e.oe)},g=function(){e.e("components/common/load-more").then(function(){return resolve(e("2c4b"))}.bind(null,e)).catch(e.oe)},v=function(){e.e("components/uni-ui/uni-popup/uni-popup").then(function(){return resolve(e("5d06"))}.bind(null,e)).catch(e.oe)},y=function(){e.e("components/uni-ui/uni-nav-bar/uni-nav-bar").then(function(){return resolve(e("50ec"))}.bind(null,e)).catch(e.oe)},w={components:{commonList:b,loadMore:g,uniPopup:v,uniNavBar:y},data:function(){return{user_id:0,userinfo:{userpic:"/static/default2.png",username:"",sex:0,age:20,isFollow:!1,regtime:"",birthday:"",job:"",path:"",qg:""},counts:[{name:"帖子",num:0},{name:"关注",num:0},{name:"粉丝",num:0}],tabIndex:0,tabBars:[{name:"主页"},{name:"帖子",list:[],loadmore:"上拉加载更多",page:1},{name:"动态",list:[],loadmore:"上拉加载更多",page:1}]}},onNavigationBarButtonTap:function(){this.clickNavigationButton()},computed:d(d({},(0,r.mapState)({user:function(t){return t.user}})),{},{list:function(){return this.tabBars[this.tabIndex].list},loadmore:function(){return this.tabBars[this.tabIndex].loadmore}}),filters:{formatNum:function(t){return t>99?"99+":t}},onShow:function(){this.getList()},onLoad:function(n){var e=this;if(!n.user_id)return t.showToast({title:"非法参数",icon:"none"});this.user_id=n.user_id,this.getUserInfo(),this.getCounts(),t.$on("updateFollowOrSupport",(function(t){switch(t.type){case"follow":e.follow(t.data.user_id);break;case"support":e.doSupport(t.data);break}})),t.$on("updateCommentsCount",(function(t){var n=t.id,o=t.count;e.tabBars.forEach((function(t){t.list&&t.list.forEach((function(t){t.id===n&&(t.comment_count=o)}))}))}))},onUnload:function(){t.$off("updateFollowOrSupport",(function(t){})),t.$off("updateCommentsCount",(function(t){}))},methods:{clickNavigationButton:function(){if(this.user_id==this.user.id)return t.navigateTo({url:"../user-set/user-set"});this.$refs.popup.open()},getCounts:function(){var t=this;this.$H.get("/user/getcounts/"+this.user_id).then((function(n){t.counts[0].num=n.post_count,t.counts[1].num=n.withfollow_count,t.counts[2].num=n.withfen_count}))},getUserInfo:function(){var n=this;this.$H.post("/getuserinfo",{user_id:this.user_id},{token:!0,notoast:!0}).then((function(e){n.userinfo={userpic:e.userpic,username:e.username,sex:e.userinfo.sex,age:e.userinfo.age,isFollow:e.fens.length>0,isblack:e.blacklist.length>0,regtime:o.default.dateFormat(new Date(1e3*e.create_time),"{Y}-{MM}-{DD}"),birthday:o.default.getHoroscope(e.userinfo.birthday),job:e.userinfo.job?e.userinfo.job:"无",path:e.userinfo.path?e.userinfo.path:"无",qg:m[e.userinfo.qg]},t.setNavigationBarTitle({title:n.userinfo.username})}))},changeTab:function(t){this.tabIndex=t,this.getList()},follow:function(n){this.tabBars.forEach((function(t){t.list&&t.list.forEach((function(t){t.user_id===n&&(t.isFollow=!0)}))})),t.showToast({title:"关注成功"})},doSupport:function(n){this.tabBars[this.tabIndex].list.forEach((function(t){t.id===n.id&&(""===t.support.type?t.support[n.type+"_count"]++:"support"===t.support.type&&"unsupport"===n.type?(t.support.support_count--,t.support.unsupport_count++):"unsupport"===t.support.type&&"support"===n.type&&(t.support.support_count++,t.support.unsupport_count--),t.support.type=n.type)}));var e="support"===n.type?"顶":"踩";t.showToast({title:e+"成功"})},getList:function(){var t=this,n=this.tabIndex;if(0!==n){var e=this.tabBars[n].page,o=1===e;this.$H.get("/user/"+this.user_id+"/post/"+e).then((function(e){var r=e.list.map((function(n){return t.$U.formatCommonList(n)}));t.tabBars[n].list=o?i(r):[].concat(i(t.tabBars[n].list),i(r)),t.tabBars[n].loadmore=r.length<10?"没有更多了":"上拉加载更多"})).catch((function(e){o||t.tabBars[n].page--}))}},doFollow:function(){var n=this;this.checkAuth((function(){var e=n.userinfo.isFollow?"/unfollow":"/follow",o=n.userinfo.isFollow?"取消关注":"关注";n.$H.post(e,{follow_id:n.user_id},{token:!0}).then((function(e){n.userinfo.isFollow=!n.userinfo.isFollow,t.showToast({title:o+"成功",icon:"none"}),t.$emit("updateIndex"),n.getList()}))}))},openUserInfo:function(){t.navigateTo({url:"../user-userinfo/user-userinfo"})},doBlack:function(){var n=this;this.checkAuth((function(){var e=n.userinfo.isblack?"/removeblack":"/addblack",o=n.userinfo.isblack?"移出黑名单":"加入黑名单";t.showModal({content:"是否要"+o,success:function(r){r.confirm&&n.$H.post(e,{id:n.user_id},{token:!0}).then((function(e){n.userinfo.isblack=!n.userinfo.isblack,t.showToast({title:o+"成功",icon:"none"})}))}})}))},openChat:function(){var t={user_id:this.user_id,username:this.userinfo.username,userpic:this.userinfo.userpic};this.navigateTo({url:"/pages/user-chat/user-chat?user="+JSON.stringify(t)})}}};n.default=w}).call(this,e("543d")["default"])}},[["3d36","common/runtime","common/vendor"]]]);
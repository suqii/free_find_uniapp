(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/search/search"],{"3d2a":function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}));var o={userList:function(){return n.e("components/user-list/user-list").then(n.bind(null,"7dc7"))}},r=function(){var t=this,e=t.$createElement;t._self._c},i=[]},8e3:function(t,e,n){"use strict";(function(t){function o(t){return c(t)||s(t)||i(t)||r()}function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(t,e){if(t){if("string"===typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}function s(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function c(t){if(Array.isArray(t))return a(t)}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=function(){Promise.all([n.e("common/vendor"),n.e("components/common/common-list2")]).then(function(){return resolve(n("9b75"))}.bind(null,n)).catch(n.oe)},l=function(){n.e("components/news/topic-list").then(function(){return resolve(n("82f4"))}.bind(null,n)).catch(n.oe)},p=function(){n.e("components/user-list/user-list").then(function(){return resolve(n("7dc7"))}.bind(null,n)).catch(n.oe)},f=function(){n.e("components/common/load-more").then(function(){return resolve(n("2c4b"))}.bind(null,n)).catch(n.oe)},h={components:{commonList:u,topicList:l,userList:p,loadMore:f},data:function(){return{searchText:"",list:[],searchList:[],type:"post",loadmore:"上拉加载更多",page:1}},onNavigationBarSearchInputChanged:function(t){this.searchText=t.text},onNavigationBarButtonTap:function(t){0===t.index&&this.searchEvent()},onLoad:function(e){var n=this;e.type&&(this.type=e.type);switch(this.type){case"post":"帖子",t.$on("updateFollowOrSupport",(function(t){switch(t.type){case"follow":n.follow(t.data.user_id);break;default:break}}));break;case"topic":"话题";break;case"user":"用户";break}var o=t.getStorageSync("historySeachText");o&&(this.list=JSON.parse(o))},onUnload:function(){"post"===this.type&&t.$off("updateFollowOrSupport",(function(t){}))},onPullDownRefresh:function(){if(""===this.searchText)return t.stopPullDownRefresh();this.getData(!0,(function(){t.stopPullDownRefresh()}))},onReachBottom:function(){"上拉加载更多"===this.loadmore&&(this.loadmore="加载中...",this.getData(!1))},methods:{goBack:function(){t.navigateBack({delta:1})},follow:function(e){this.searchList.forEach((function(t){t.user_id===e&&(t.isFollow=!0)})),t.showToast({title:"关注成功"})},doSupport:function(e){this.searchList.forEach((function(t){t.id===e.id&&(""===t.support.type?t.support[e.type+"_count"]++:"support"===t.support.type&&"unsupport"===e.type?(t.support.support_count--,t.support.unsupport_count++):"unsupport"===t.support.type&&"support"===e.type&&(t.support.support_count++,t.support.unsupport_count--),t.support.type=e.type)}));var n="support"===e.type?"顶":"踩";t.showToast({title:n+"成功"})},clickSearchHistory:function(t){this.searchText=t,this.searchEvent()},searchEvent:function(){var e=this;t.hideKeyboard();var n=this.list.findIndex((function(t){return t===e.searchText}));-1!==n?this.$U.__toFirst(this.list,n):this.list.unshift(this.searchText),t.setStorageSync("historySeachText",JSON.stringify(this.list)),this.getData()},getData:function(){var e=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.showLoading({title:"加载中...",mask:!1}),this.page=n?1:this.page+1,this.$H.post("/search/"+this.type,{keyword:this.searchText,page:this.page}).then((function(i){var s=[];switch(e.type){case"post":s=i.list.map((function(t){return e.$U.formatCommonList(t)}));break;case"topic":s=i.list.map((function(t){return{id:t.id,cover:t.titlepic,title:t.title,desc:t.desc,today_count:t.todaypost_count,news_count:t.post_count}}));break;case"user":s=i.list.map((function(t){return{id:t.id,avatar:t.userpic,username:t.username,sex:t.userinfo.sex,age:t.userinfo.age,isFollow:!1}}));break}console.log(JSON.stringify(s)),e.searchList=n?o(s):[].concat(o(e.searchList),o(s)),e.loadmore=s.length<10?"没有更多了":"上拉加载更多",t.hideLoading(),"function"===typeof r&&r()})).catch((function(n){e.page--,t.hideLoading(),"function"===typeof r&&r()}))}}};e.default=h}).call(this,n("543d")["default"])},be9c:function(t,e,n){"use strict";(function(t){n("9e51");o(n("66fd"));var e=o(n("c8ce"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},c8ce:function(t,e,n){"use strict";n.r(e);var o=n("3d2a"),r=n("d5dc");for(var i in r)"default"!==i&&function(t){n.d(e,t,(function(){return r[t]}))}(i);var s,c=n("f0c5"),a=Object(c["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);e["default"]=a.exports},d5dc:function(t,e,n){"use strict";n.r(e);var o=n("8000"),r=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=r.a}},[["be9c","common/runtime","common/vendor"]]]);